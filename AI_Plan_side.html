<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Study Planner App</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM -->
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Lucide Icons UMD -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
</head>

<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function StudyPlannerApp() {
      const [currentView, setCurrentView] = useState('schedule'); // 'schedule' or 'ai'
      const [userPlans, setUserPlans] = useState([
        { id: 1, title: 'ÏòÅÏñ¥ Îã®Ïñ¥ ÏïîÍ∏∞', memo: 'ÏÉà Îã®Ïñ¥ 20Í∞ú', start: '16:00', end: '17:00', emoji: 'üìö' },
        { id: 2, title: 'ÏàòÌïô Î¨∏Ï†ú ÌíÄÏù¥', memo: 'Í∏∞Ï∂úÎ¨∏Ï†ú 5Í∞ú', start: '18:00', end: '19:30', emoji: 'üìê' }
      ]);
      const [aiPlans, setAiPlans] = useState([]);
      const [draggedItem, setDraggedItem] = useState(null);
      const [showModal, setShowModal] = useState(false);
      const [editingPlan, setEditingPlan] = useState(null);
      const [newPlan, setNewPlan] = useState({
        title: '', memo: '', start: '21:00', end: '22:00', emoji: 'üìö'
      });

      // Lucide Î†åÎçî
      useEffect(() => { lucide.createIcons() }, []);

      // 30Î∂Ñ Îã®ÏúÑ Ïä¨Î°Ø
      const timeSlots = Array.from({ length: (24 - 8) * 2 + 3 * 2 }, (_, i) => {
        const total = 8 * 60 + i * 30;
        const h = Math.floor(total / 60) % 24, m = total % 60;
        return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
      });

      // Drag & Drop Ìï∏Îì§Îü¨
      const handleDragStart = (e, p) => {
        setDraggedItem(p);
        e.dataTransfer.effectAllowed = 'move';
      };
      const handleDragOver = e => e.preventDefault();
      const handleDrop = (e, targetStart) => {
        e.preventDefault();
        if (!draggedItem) return;
        const [sh, sm] = draggedItem.start.split(':').map(Number);
        const [eh, em] = draggedItem.end.split(':').map(Number);
        const duration = (eh * 60 + em) - (sh * 60 + sm);
        const [h, m] = targetStart.split(':').map(Number);
        const endTotal = h * 60 + m + duration;
        const endH = Math.floor(endTotal / 60) % 24, endM = endTotal % 60;
        const updated = {
          ...draggedItem,
          start: targetStart,
          end: `${String(endH).padStart(2, '0')}:${String(endM).padStart(2, '0')}`
        };
        setUserPlans(plans => plans.map(x => x.id === updated.id ? updated : x));
        setDraggedItem(null);
      };

      // ÏÇ≠Ï†ú
      const deletePlan = id => {
        setUserPlans(plans => plans.filter(x => x.id !== id));
      };

      // ÏàòÏ†ï Î™®Îã¨ Ïó¥Í∏∞
      const onEdit = plan => {
        setEditingPlan(plan);
        setNewPlan({
          title: plan.title,
          memo: plan.memo,
          start: plan.start,
          end: plan.end,
          emoji: plan.emoji
        });
        setShowModal(true);
      };

      // AI Ï∂îÏ≤ú ÏÉùÏÑ±
      const generateAiSuggestions = () => {
        const sugg = [
          { title: 'Î¨ºÎ¶¨ Í≥µÏãù Ï†ïÎ¶¨', emoji: '‚öõÔ∏è' },
          { title: 'Ïó≠ÏÇ¨ Ïó∞Ìëú ÏïîÍ∏∞', emoji: 'üìú' },
          { title: 'ÏÉùÎ¨º ÏÑ∏Ìè¨ Íµ¨Ï°∞', emoji: 'üî¨' },
          { title: 'Î¨∏Ìïô ÏûëÌíà Î∂ÑÏÑù', emoji: 'üìñ' },
          { title: 'ÌôîÌïô Î∞òÏùëÏãù', emoji: 'üß™' }
        ];
        const pick = sugg.sort(() => 0.5 - Math.random()).slice(0, 3);
        const newAi = pick.map((it, i) => ({
          id: Date.now() + i,
          title: it.title,
          memo: '',
          start: `${19 + i}:00`,
          end: `${20 + i}:00`,
          emoji: it.emoji
        }));
        setAiPlans(newAi);
      };

      // AI ÌîåÎûú Ï†ÅÏö©
      const applyAiPlans = () => {
        const cloned = aiPlans.map(pl => ({
          ...pl, id: Date.now() + Math.random()
        }));
        setUserPlans(plans => [...plans, ...cloned]);
        setAiPlans([]);
        setCurrentView('schedule');
      };

      // ÏÉà/ÏàòÏ†ï ÌôïÏ†ï
      const savePlan = () => {
        if (!newPlan.title || !newPlan.start || !newPlan.end) return;
        if (editingPlan) {
          setUserPlans(plans => plans.map(x => x.id === editingPlan.id ? { ...editingPlan, ...newPlan } : x));
        } else {
          setUserPlans(plans => [...plans, { ...newPlan, id: Date.now() }]);
        }
        setEditingPlan(null);
        setNewPlan({ title: '', memo: '', start: '21:00', end: '22:00', emoji: 'üìö' });
        setShowModal(false);
      };

      return (
        <div className="max-w-md mx-auto bg-white min-h-screen relative overflow-hidden">
          {/* Ìó§Îçî */}
          <header className="bg-orange-50 p-3 border-b border-orange-100 sticky top-0 z-10 flex justify-between items-center">
            <h1 className="text-xl font-bold text-gray-800">My Plan</h1>
            <div className="flex gap-2">
              <button onClick={() => window.location.reload()} className="p-2 text-orange-600 hover:bg-orange-100 rounded-lg">
                <i data-lucide="refresh-cw" className="lucide" style={{ width: 20, height: 20 }} />
              </button>
              <button onClick={() => alert('ÏÑ§Ï†ï')} className="p-2 text-orange-600 hover:bg-orange-100 rounded-lg">
                <i data-lucide="settings" className="lucide" style={{ width: 20, height: 20 }} />
              </button>
            </div>
          </header>

          {/* ÏΩòÌÖêÏ∏† */}
          <div className="flex h-full">
            {/* Ïä§ÏºÄÏ§Ñ Î∑∞ */}
            <div className={`w-full transition-transform duration-300 ${currentView === 'ai' ? ' -translate-x-full ' : ' translate-x-0'}`}>
              <div className="p-4 h-screen overflow-y-auto pb-28 bg-orange-50">
                {timeSlots.map(time => {
                  const isHour = time.endsWith(':00');
                  const plansHere = userPlans.filter(p => p.start === time);
                  return (
                    <div key={time}
                      onDragOver={handleDragOver}
                      onDrop={e => handleDrop(e, time)}
                      className={`flex items-start ${isHour ? 'min-h-16 bg-white' : 'min-h-8 bg-gray-50'} border-b border-gray-200`}>
                      <div className="w-16 text-center text-gray-600 font-medium pt-2">{isHour ? time : ''}</div>
                      <div className="flex-1 pl-4 space-y-2 pb-2">
                        {plansHere.map(plan => (
                          <div key={plan.id}
                            draggable
                            onDragStart={e => handleDragStart(e, plan)}
                            className="relative p-3 bg-white border-2 border-orange-500 rounded-xl shadow-sm cursor-move hover:shadow-md">
                            <div className="absolute top-1 right-1 flex space-x-1">
                              <button onClick={() => onEdit(plan)} className="p-1 rounded hover:bg-gray-200">
                                <i data-lucide="edit-3" className="lucide" style={{ width: 14, height: 14 }} />
                              </button>
                              <button onClick={() => deletePlan(plan.id)} className="p-1 rounded hover:bg-gray-200">
                                <i data-lucide="trash-2" className="lucide" style={{ width: 14, height: 14 }} />
                              </button>
                            </div>
                            <div className="flex items-center gap-2">
                              <span className="text-lg">{plan.emoji}</span>
                              <div className="flex-1">
                                <div className="font-medium text-sm">{plan.title}</div>
                                <div className="text-xs text-gray-500">{plan.start} ~ {plan.end}</div>
                                {plan.memo && <div className="text-xs text-gray-600">Î©îÎ™®: {plan.memo}</div>}
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>

            {/* AI Î∑∞ */}
            <div className={`w-full absolute top-0 transition-transform duration-300 ${currentView === 'ai' ? 'translate-x-0' : 'translate-x-full'
              }`}>
              <div className="p-4 h-screen overflow-y-auto pb-28 bg-orange-100">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-lg font-bold flex items-center gap-2">
                    <span>ü§ñ</span> AI Ï∂îÏ≤ú ÌîåÎûú
                  </h2>
                  <button onClick={() => setCurrentView('schedule')} className="text-orange-600">‚Üê ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
                <div className="space-y-3">
                  {aiPlans.map(pl => (
                    <div key={pl.id} className="p-4 bg-orange-500 text-white rounded-xl shadow-sm">
                      <div className="flex items-center gap-3">
                        <span className="text-2xl">{pl.emoji}</span>
                        <div>
                          <div className="font-medium">{pl.title}</div>
                          <div className="text-sm text-orange-100">{pl.start} ~ {pl.end}</div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                {/* AI ÏÉùÏÑ± Î≤ÑÌäº */}
                {aiPlans.length === 0 && (
                  <div className="text-center py-8">
                    <button onClick={generateAiSuggestions}
                      className="bg-orange-500 text-white px-6 py-3 rounded-full">
                      AI ÌîåÎûú ÏÉùÏÑ±ÌïòÍ∏∞
                    </button>
                  </div>
                )}

                {/* Ï†ÅÏö© Î≤ÑÌäº */}
                {aiPlans.length > 0 && (
                  <div className="text-center mt-6">
                    <button onClick={applyAiPlans}
                      className="bg-orange-500 text-white px-6 py-3 rounded-full">
                      ÎÇ¥ ÌîåÎûòÎÑàÏóê Ï†ÅÏö©
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* ÌïòÎã® Î™ÖÎ†π Î∞î */}
          <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4">
            <div className="max-w-md mx-auto flex gap-3">
              {currentView === 'schedule' ? (
                <button onClick={() => setCurrentView('ai')}
                  className="flex-1 bg-white border-2 border-orange-500 text-orange-500 py-3 rounded-full">
                  AIÏóê Î™ÖÎ†π
                </button>
              ) : (
                <div className="flex-1 flex items-center bg-white border-2 border-orange-500 rounded-full px-3 py-2">
                  <input
                    type="text"
                    placeholder="AIÏóêÍ≤å ÌîåÎûúÏùÑ ÏöîÏ≤≠Ìï¥Î≥¥ÏÑ∏Ïöî"
                    className="flex-1 outline-none bg-transparent text-orange-500 placeholder-orange-300"
                    onKeyDown={e => {
                      if (e.key === 'Enter') generateAiSuggestions();
                    }}
                  />
                  <span className="ml-2 text-2xl">ü§ñ</span>
                </div>
              )}
              {currentView === 'ai' && aiPlans.length > 0 && (
                <button onClick={applyAiPlans}
                  className="flex-1 bg-orange-500 text-white py-3 rounded-full">
                  Ï†ÅÏö©
                </button>
              )}
            </div>
          </div>

          {/* ÌîåÎûú Ï∂îÍ∞Ä/ÏàòÏ†ï Î™®Îã¨ */}
          {showModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
              <div className="bg-white rounded-2xl w-full max-w-sm p-6">
                <h3 className="text-xl font-bold text-center mb-4">
                  {editingPlan ? 'ÏùºÏ†ï ÏàòÏ†ï' : 'ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä'}
                </h3>
                <div className="space-y-4">
                  <div>
                    <label className="block mb-1">Ìï† Ïùº</label>
                    <input type="text" value={newPlan.title}
                      onChange={e => setNewPlan(p => ({ ...p, title: e.target.value }))}
                      className="w-full border p-2 rounded" />
                  </div>
                  <div>
                    <label className="block mb-1">Î©îÎ™®</label>
                    <input type="text" value={newPlan.memo}
                      onChange={e => setNewPlan(p => ({ ...p, memo: e.target.value }))}
                      className="w-full border p-2 rounded" />
                  </div>
                  <div>
                    <label className="block mb-1">ÏãúÍ∞Ñ</label>
                    <div className="flex items-center gap-2">
                      <input type="time" value={newPlan.start}
                        onChange={e => setNewPlan(p => ({ ...p, start: e.target.value }))}
                        className="border p-2 rounded w-1/2" />
                      <span>~</span>
                      <input type="time" value={newPlan.end}
                        onChange={e => setNewPlan(p => ({ ...p, end: e.target.value }))}
                        className="border p-2 rounded w-1/2" />
                    </div>
                  </div>
                  <div>
                    <label className="block mb-1">Ïù¥Î™®ÏßÄ</label>
                    <div className="flex gap-2">
                      {['üìö', '‚úèÔ∏è', 'üìê', 'üß™', 'üí°'].map(em => (
                        <button key={em} onClick={() => setNewPlan(p => ({ ...p, emoji: em }))}
                          className={`p-2 text-2xl rounded ${newPlan.emoji === em ? 'bg-orange-100' : ''}`}>
                          {em}
                        </button>
                      ))}
                    </div>
                  </div>
                </div>
                <div className="mt-6 flex gap-3">
                  <button onClick={() => { setShowModal(false); setEditingPlan(null); }}
                    className="flex-1 border py-3 rounded">Ï∑®ÏÜå</button>
                  <button onClick={savePlan}
                    className="flex-1 bg-orange-500 text-white py-3 rounded">
                    {editingPlan ? 'ÏàòÏ†ï ÏôÑÎ£å' : 'Ï∂îÍ∞Ä'}
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä Î≤ÑÌäº */}
          <button onClick={() => { setEditingPlan(null); setShowModal(true); }}
            className="fixed bottom-24 right-4 bg-orange-500 text-white w-14 h-14 rounded-full flex items-center justify-center">
            <i data-lucide="plus" className="lucide" style={{ width: 24, height: 24 }} />
          </button>
        </div>
      );
    }

    ReactDOM.render(<StudyPlannerApp />, document.getElementById('root'));
  </script>
</body>

</html>